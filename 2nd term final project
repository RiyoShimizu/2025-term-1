<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>back number Fortune</title>
<style>
  /* Base Style */
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    background: #f4f4f4;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    color: #333;
    transition: background 0.8s ease;
  }

  /* Particles */
  .particle {
    position: absolute;
    background: rgba(255,255,255,0.6);
    border-radius: 50%;
    pointer-events: none;
    animation: float 15s linear infinite;
    z-index: 0;
  }
  @keyframes float {
    0% { transform: translateY(110vh) scale(0.5); opacity: 0; }
    20% { opacity: 0.8; }
    100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
  }

  /* Main Container (Semantic Tag used) */
  main#app {
    position: relative;
    z-index: 10;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 30px;
    border-radius: 24px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    width: 90%;
    max-width: 420px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.5);
  }

  header h1 { margin: 0 0 20px 0; font-size: 1.6rem; letter-spacing: 1px; font-weight: 800; }

  /* Controls */
  .controls { display: flex; gap: 12px; margin-bottom: 20px; }
  .group { flex: 1; text-align: left; }
  label { font-size: 0.75rem; font-weight: bold; text-transform: uppercase; margin-bottom: 6px; display: block; opacity: 0.7; }
  
  input, select {
    width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ccc;
    font-size: 0.95rem; box-sizing: border-box; outline: none; background: rgba(255,255,255,0.9);
  }

  /* Button */
  button {
    width: 100%; padding: 16px; font-size: 1.05rem; font-weight: bold;
    background: #222; color: #fff; border: none; border-radius: 12px;
    cursor: pointer; transition: transform 0.1s, opacity 0.2s;
  }
  button:hover { transform: scale(1.02); }
  button:active { transform: scale(0.98); }
  button:disabled { opacity: 0.6; cursor: wait; }

  /* Result Area */
  #result {
    display: none; margin-top: 30px; padding-top: 20px;
    border-top: 1px dashed rgba(0,0,0,0.2);
    animation: slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
  }
  @keyframes slideUp { from{opacity:0;transform:translateY(15px);} to{opacity:1;transform:translateY(0);} }

  #jacketImg {
    width: 220px; height: 220px; object-fit: cover;
    border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    margin: 0 auto 15px; display: block; background: #ddd;
  }
  
  #songTitle { font-size: 1.5rem; font-weight: 900; margin-bottom: 8px; line-height: 1.3; }
  
  #luckBadge {
    display: inline-block; padding: 6px 18px; background: #fff;
    border-radius: 20px; font-size: 1rem; font-weight: bold; color: #e53935;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  
  /* Reset Button */
  #resetLink {
    display: block; margin-top: 15px; font-size: 0.8rem; color: #666; cursor: pointer; text-decoration: underline;
  }
</style>
</head>
<body>

<main id="app">
  <header>
    <h1>backnumber Fortune ðŸŽ§</h1>
  </header>

  <div class="controls">
    <div class="group">
      <label>Date</label>
      <input type="date" id="dateInput">
    </div>
    <div class="group">
      <label>Mood</label>
      <select id="moodSelect">
        <option value="bright">Bright</option>
        <option value="dark">Sentimental</option>
        <option value="calm">Calm</option>
        <option value="passionate">Passionate</option>
      </select>
    </div>
  </div>

  <button id="btn">Check Fortune</button>

  <div id="result">
    <img id="jacketImg" src="" alt="CD Jacket">
    <div id="songTitle"></div>
    <div id="luckBadge"></div>
    <span id="resetLink" onclick="clearData()">Clear Data</span>
  </div>
</main>

<script>
  // 1. Particle Effect
  function createParticles() {
    for(let i=0; i<25; i++){
      let p = document.createElement('div');
      p.className = 'particle';
      document.body.appendChild(p);
      p.style.left = Math.random() * 100 + 'vw';
      p.style.width = p.style.height = (Math.random()*8+4)+'px';
      p.style.animationDuration = (Math.random()*10+10)+'s';
      p.style.animationDelay = Math.random()*5+'s';
    }
  }

  // 2. Data
  const data = {
    bright: {
      color: "#fffde7",
      songs: [
        { t: "é«˜å¶ºã®èŠ±å­ã•ã‚“", i: "https://m.media-amazon.com/images/I/71lK-HR131L._UF1000%2C1000_QL80_.jpg" },
        { t: "æ€ªç›—", i: "https://aop-emtg-jp.s3.amazonaws.com/prod/public/backnumber/contents/information/e4bae53a660af325350b5f2998730590.jpg" },
        { t: "å›ã®æ‹äººã«ãªã£ãŸã‚‰", i: "https://sp-m.mu-mo.net/image/jacket/29/1_11764294.jpg" }
      ]
    },
    dark: {
      color: "#eceff1",
      songs: [
        { t: "ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰", i: "https://img.hmv.co.jp/image/jacket/400/73/0/1/000.jpg" },
        { t: "ã¯ãªã³ã‚‰", i: "https://ogre.natalie.mu/media/news/music/2011/0330/backnumber_UMCK5319.jpg" },
        { t: "å†¬ã¨æ˜¥", i: "https://aop-emtg-jp.s3.amazonaws.com/prod/public/backnumber/contents/information/b26d5a036565c19b0c439d97e9d03009.jpg" }
      ]
    },
    calm: {
      color: "#e3f2fd",
      songs: [
        { t: "ã‚¯ãƒªã‚¹ãƒžã‚¹ã‚½ãƒ³ã‚°", i: "https://ogre.natalie.mu/media/news/music/2015/1012/backnumber_christmassong_normal_jk.jpg" },
        { t: "HAPPY BIRTHDAY", i: "https://ogre.natalie.mu/media/news/music/2019/0114/backnumber_jkt201901_tsujo.jpg" },
        { t: "çž¬ã", i: "https://backnumber.info/static2/prod/public/backnumber/contents/information/20171120192144.jpg" }
      ]
    },
    passionate: {
      color: "#fce4ec",
      songs: [
        { t: "ãƒ’ãƒ­ã‚¤ãƒ³", i: "https://rockinon.com/images/entry/width%3A750/115423/2" },
        { t: "ã‚ªãƒ¼ãƒ«ãƒ‰ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³", i: "https://content-jp.umgi.net/products/um/UMCK-5664_bFt_extralarge.jpg" },
        { t: "ã‚¢ã‚¤ãƒ©ãƒ–ãƒ¦ãƒ¼", i: "https://ogre.natalie.mu/media/news/music/2022/1009/backnumber_jkt202210.jpg" }
      ]
    }
  };
  const fortunes = ["Excellent Luck", "Good Luck", "Small Luck", "Future Luck"];

  // 3. Logic with LocalStorage
  function checkFortune() {
    const btn = document.getElementById('btn');
    const mood = document.getElementById('moodSelect').value;
    const dateVal = document.getElementById('dateInput').value;

    btn.disabled = true;
    btn.textContent = "Loading...";
    document.getElementById('result').style.display = 'none';

    // Theme Change
    const theme = data[mood];
    document.body.style.backgroundColor = theme.color;

    setTimeout(() => {
      const song = theme.songs[Math.floor(Math.random() * theme.songs.length)];
      const luck = fortunes[Math.floor(Math.random() * fortunes.length)];

      displayResult(song, luck);

      // â˜… SAVE DATA (JSON.stringify)
      const saveObj = {
        song: song,
        luck: luck,
        mood: mood,
        date: dateVal
      };
      localStorage.setItem('bnFortune', JSON.stringify(saveObj));

      btn.textContent = "Check Again";
      btn.disabled = false;
    }, 600);
  }

  function displayResult(song, luck) {
    document.getElementById('songTitle').textContent = song.t;
    document.getElementById('luckBadge').textContent = luck;
    
    const imgEl = document.getElementById('jacketImg');
    imgEl.src = song.i;
    imgEl.onerror = function() {
      this.src = "https://placehold.co/400x400/ddd/555?text=back+number";
    };

    document.getElementById('result').style.display = 'block';
  }

  // â˜… LOAD DATA (JSON.parse)
  function loadData() {
    const saved = localStorage.getItem('bnFortune');
    if(saved) {
      const obj = JSON.parse(saved);
      // Restore Inputs
      document.getElementById('moodSelect').value = obj.mood;
      document.getElementById('dateInput').value = obj.date;
      // Restore Theme
      if(data[obj.mood]) document.body.style.backgroundColor = data[obj.mood].color;
      // Restore Result
      displayResult(obj.song, obj.luck);
    }
  }

  function clearData() {
    localStorage.removeItem('bnFortune');
    alert("Data Cleared!");
    location.reload();
  }

  // Init
  document.getElementById('dateInput').valueAsDate = new Date();
  document.getElementById('btn').addEventListener('click', checkFortune);
  createParticles();
  
  // Load previous result on start
  loadData();

</script>
</body>
</html>
